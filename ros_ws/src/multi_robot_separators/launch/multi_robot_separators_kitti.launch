<launch>
<!-- Change these parameters -->
<arg name="local_robot_id" default="0" />  
<arg name="other_robot_id" default="1" />  
<arg name="frame_id" default="camera_color_left" />  
<arg name="estimate_stereo_transform_from_tf" default="false" />  


<!-- Play the bag within the namespace -->
<arg name="node_start_delay" default="30.0" />  
<node pkg="rosbag" type="play" name="playback_$(arg local_robot_id)" args="/kitti_data_orig/kitti_data_odometry_color_sequence_00_part1.bag" launch-prefix="bash -c 'sleep $(arg node_start_delay); $0 $@' " >
  <remap from="/kitti/camera_color_left/image_rect" to="/robot_$(arg local_robot_id)/kitti/camera_color_left/image_rect"/>
  <remap from="/kitti/camera_color_right/image_rect" to="/robot_$(arg local_robot_id)/kitti/camera_color_right/image_rect"/>
  <remap from="/kitti/camera_color_left/camera_info" to="/robot_$(arg local_robot_id)/kitti/camera_color_left/camera_info"/>
  <remap from="/kitti/camera_color_right/camera_info" to="/robot_$(arg local_robot_id)/kitti/camera_color_right/camera_info"/>
</node>

<!-- Change the robot id here too! -->
  <group ns="robot_$(arg local_robot_id)">

    <!-- Don't forget to change the robot ID in the name space! -->
    <param name="local_robot_id" type="int" value="$(arg local_robot_id)" />
    <param name="other_robot_id" type="int" value="$(arg other_robot_id)" />
    <param name="frame_id"      type="string" value="$(arg frame_id)"/>
    <param name="estimate_stereo_transform_from_tf" type="bool" value="$(arg estimate_stereo_transform_from_tf)"/>

   <!-- Covariance of separators parameters -->
    <param name="set_fixed_covariance" type="bool" value="true" />
    <param name="translation_std" type="double" value="0.3" />
    <param name="rotation_std" type="double" value="0.05" />

   <!-- Also send estimates of poses with separators found. Requires to have a service to compute those advertised -->
    <param name="use_estimates_of_poses" type="bool" value="false" /> 
    
    <!-- Remapping image topics -->
    <remap from="rgb/image_rect" to="kitti/camera_color_left/image_rect"/>
    <remap from="left/image_rect" to="kitti/camera_color_left/image_rect"/>
    <remap from="right/image_rect" to="kitti/camera_color_right/image_rect"/>
    <remap from="left/camera_info" to="kitti/camera_color_left/camera_info"/>
    <remap from="right/camera_info" to="kitti/camera_color_right/camera_info"/>

    <!-- Nodes to run -->
    <node pkg="multi_robot_separators" type="stereo_cam_geometric_tools" name="stereo_cam_geometric_tools"/>
    <node pkg="multi_robot_separators" type="find_separators.py" name="find_separators"/>
    <node pkg="multi_robot_separators" type="factor_graph" name="factor_graph"/>
    <node pkg="multi_robot_separators" type="communication" name="communication"/>

    <!-- Stereo Odometry -->   
    <node pkg="rtabmap_ros" type="stereo_odometry" name="stereo_odometry" output="screen">
      <param name="frame_id"      type="string" value="$(arg frame_id)"/>
      <param name="estimate_stereo_transform_from_tf" type="bool" value="$(arg estimate_stereo_transform_from_tf)"/>
        <!-- <param name="Odom/Strategy"      type="string" value="1"/> 0=Frame-to-Map, 1=Frame=to=Frame -->
        <!-- <param name="Odom/ImageBufferSize"  type="string" value="0"/>  -->
        <!-- <param name="Vis/EstimationType" type="string" value="1"/> 0=3D->3D 1=3D->2D (PnP) -->
        <!-- <param name="Vis/PnPFlags"       type="string" value="0"/> -->
        <!-- <param name="Vis/PnPReprojError"     type="string" value="1"/> -->
        <!-- <param name="Vis/CorFlowWinSize"     type="string" value="15"/> -->
        <!-- <param name="Vis/CorType"     type="string" value="1"/> -->
        <!-- <param name="GFTT/MinDistance"   type="string" value="10"/> -->
        <!-- <param name="GFTT/QualityLevel"  type="string" value="0.002"/>  -->
        <!-- <param name="Icp/CorrespondenceRatio"  type="string" value="0.1"/>  -->
        <!-- <param name="Icp/Iterations"  type="string" value="10"/>  -->
        <!-- <param name="Icp/MaxCorrespondenceDistance"  type="string" value="0.3"/>  -->
        <!-- <param name="Icp/PointToPlane"  type="string" value="true"/>  -->
        <!-- <param name="Icp/MaxTranslation"  type="string" value="0"/>  -->
        <!-- <param name="Icp/VoxelSize"  type="string" value="0"/>  -->
        <!-- <param name="Icp/Epsilon"  type="string" value="0.01"/>  -->
        <!-- <param name="Reg/Strategy"  type="string" value="0"/>  -->
    </node>


  </group>
</launch>